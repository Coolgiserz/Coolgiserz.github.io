<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.5.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="CoolCats" />

  
  
  
    
  
  <meta name="description" content="从入门小示例到生产应用的各个环节总结" />

  
  <link rel="alternate" hreflang="en-us" href="/post/django-core-techs-notes/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.c7b8d9abd591ba2253ea42747e3ac3f5.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha512-W0xM4mr6dEP9nREo7Z9z+9X70wytKvMGeDsj7ps2+xg5QPrEBXC8tAW1IFnzjR6eoJ90JmCnFzerQJTLzIEHjA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.1052fab8b7700a3dc49ee23683097d66.css" />

  



  


  


  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?51ae6db546b05b91d4053193ba49123d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  
  
  

  

  

  <link rel="icon" type="image/png" href="/media/icon_hue03491371183284312b8b116a73ae5ab_79511_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hue03491371183284312b8b116a73ae5ab_79511_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="/post/django-core-techs-notes/" />

  
  
  
  
  
  
  
  
    
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@wowchemy" />
    <meta property="twitter:creator" content="@wowchemy" />
  
  <meta property="og:site_name" content="CoolCats" />
  <meta property="og:url" content="/post/django-core-techs-notes/" />
  <meta property="og:title" content="Django后端开发笔记 | CoolCats" />
  <meta property="og:description" content="从入门小示例到生产应用的各个环节总结" /><meta property="og:image" content="/media/icon_hue03491371183284312b8b116a73ae5ab_79511_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="/media/icon_hue03491371183284312b8b116a73ae5ab_79511_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2023-07-02T22:57:15&#43;08:00"
      />
    
    <meta property="article:modified_time" content="2023-12-10T22:57:15&#43;08:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/django-core-techs-notes/"
  },
  "headline": "Django后端开发笔记",
  
  "datePublished": "2023-07-02T22:57:15+08:00",
  "dateModified": "2023-12-10T22:57:15+08:00",
  
  "author": {
    "@type": "Person",
    "name": "CoolCats"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "CoolCats",
    "logo": {
      "@type": "ImageObject",
      "url": "/media/icon_hue03491371183284312b8b116a73ae5ab_79511_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "从入门小示例到生产应用的各个环节总结"
}
</script>

  

  

  

  





  <title>Django后端开发笔记 | CoolCats</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="8dc4472902b35fd572e462bb082a0f50" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.2ed908358299dd7ab553faae685c746c.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/">CoolCats</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/">CoolCats</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/post"><span>博客</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/event"><span>趣事</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/project"><span>项目</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/publication"><span>论文</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/contact"><span>联系</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/media/files/cv"><span>简历</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Django后端开发笔记</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Dec 10, 2023
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    7 min read
  </span>
  

  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/python/">Python</a></span>
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <h2 id="0x00-django核心技术栈">0x00 Django核心技术栈</h2>
<h3 id="django的能力">Django的能力</h3>
<h4 id="url路由配置和管理">Url路由配置和管理</h4>
<p><a href="https://docs.djangoproject.com/en/4.2/topics/http/urls/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/4.2/topics/http/urls/</a></p>
<h4 id="数据库迁移migrations">数据库迁移（Migrations）</h4>
<p><a href="https://docs.djangoproject.com/en/4.2/topics/migrations/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/4.2/topics/migrations/</a></p>
<p>Django提供了一种数据库状态迁移的功能，即通过migrate命令将models.py文件中定义数据库模型状态（包括变更）同步到数据库中。</p>
<ul>
<li>
<p>makemigrations</p>
</li>
<li>
<p>sqlmigrate</p>
<p>输出数据库模型迁移相关sql语句（DDL）</p>
</li>
<li>
<p>showmigrations</p>
<p>显示数据库模型变更情况，如下图，由于django项目刚创建，默认的管理员后台相关数据模型并未同步到数据库中，所以下图显示存在若干变更待迁移。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/showmigrations_hu563f4287b8d634b1cf2e2c9816b865d6_155293_b81760779e2e089d6aa67f248b98d528.webp 400w,
               /post/django-core-techs-notes/images/showmigrations_hu563f4287b8d634b1cf2e2c9816b865d6_155293_26c77a183d148697c3ab0ed8ac2d558a.webp 760w,
               /post/django-core-techs-notes/images/showmigrations_hu563f4287b8d634b1cf2e2c9816b865d6_155293_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/showmigrations_hu563f4287b8d634b1cf2e2c9816b865d6_155293_b81760779e2e089d6aa67f248b98d528.webp"
               width="760"
               height="445"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
</li>
<li>
<p>migrate</p>
</li>
</ul>
<pre tabindex="0"><code>python manage.py migrate
</code></pre><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/django_migrate_hua6adb94c601d9a0d092832091430aa76_130280_45b5b24782fc64e023cf2882c5862e2e.webp 400w,
               /post/django-core-techs-notes/images/django_migrate_hua6adb94c601d9a0d092832091430aa76_130280_5371c24257416e0499c319d5254fe272.webp 760w,
               /post/django-core-techs-notes/images/django_migrate_hua6adb94c601d9a0d092832091430aa76_130280_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/django_migrate_hua6adb94c601d9a0d092832091430aa76_130280_45b5b24782fc64e023cf2882c5862e2e.webp"
               width="760"
               height="281"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>执行如上所述数据库迁徙命令，再showmigrations，可见数据库迁徙记录（已完成）</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/showmigrations2_hu4a5775e306111726351d06293c97a46d_153252_e94d8952170520e816c1ff8a98f2e0fb.webp 400w,
               /post/django-core-techs-notes/images/showmigrations2_hu4a5775e306111726351d06293c97a46d_153252_51352eb96b5795d94db2d484ac51ae0c.webp 760w,
               /post/django-core-techs-notes/images/showmigrations2_hu4a5775e306111726351d06293c97a46d_153252_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/showmigrations2_hu4a5775e306111726351d06293c97a46d_153252_e94d8952170520e816c1ff8a98f2e0fb.webp"
               width="760"
               height="445"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<ul>
<li>&hellip;</li>
</ul>
<h5 id="关于django对postgres中多模式schema的适用问题">关于django对postgres中多模式（schema）的适用问题</h5>
<p><a href="https://www.amvtek.com/blog/posts/2014/Jun/13/accessing-multiple-postgres-schemas-from-django/" target="_blank" rel="noopener">Accessing multiple postgres schemas from Django</a></p>
<p><a href="https://github.com/bernardopires/django-tenant-schemas" target="_blank" rel="noopener">https://github.com/bernardopires/django-tenant-schemas</a></p>
<p><a href="https://dba.stackexchange.com/questions/208826/django-postgres-multiple-schema" target="_blank" rel="noopener">postgresql - Django postgres multiple schema - Database Administrators Stack Exchange</a></p>
<h4 id="多数据库协作">多数据库协作</h4>
<p>实际项目中，不同模块的数据可能存放于不同的数据库中，那么Django在对Model进行增删改查时，如何定位到Model属于哪个数据库并进行正确操作呢？</p>
<p>我们可以通过定义以app_label为key，数据库配置为value的数据库配置映射。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/db_router_hu546e8ea9e5d15387a4ac1909dd10746f_68967_4f6c8bac8b40d336f40ec5fc152b1112.webp 400w,
               /post/django-core-techs-notes/images/db_router_hu546e8ea9e5d15387a4ac1909dd10746f_68967_09ff453a7a9badbe69f49bc65ad9df2e.webp 760w,
               /post/django-core-techs-notes/images/db_router_hu546e8ea9e5d15387a4ac1909dd10746f_68967_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/db_router_hu546e8ea9e5d15387a4ac1909dd10746f_68967_4f6c8bac8b40d336f40ec5fc152b1112.webp"
               width="760"
               height="304"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>通过实现DATABASE_ROUTERS配置所需要的辅助类，可以自定义应用相关数据所关联的数据库相关操作行为。官方文档给出了一些示例代码，本文暂时不展开（我还没详细看其中的源码）。</p>
<p><a href="https://docs.djangoproject.com/en/4.2/topics/db/multi-db/" target="_blank" rel="noopener">Multiple databases | Django documentation | Django</a></p>
<h4 id="form和modelform表单验证">Form和ModelForm表单验证</h4>
<h4 id="model数据库设计和操作">Model数据库设计和操作</h4>
<h4 id="cookie和session的登录原理">cookie和session的登录原理</h4>
<h4 id="template模版">template模版</h4>
<h4 id="表结构设计">表结构设计</h4>
<h4 id="外键和一对多关系设计">外键和一对多关系设计</h4>
<p><a href="https://stackoverflow.com/questions/49470367/install-virtualenv-and-virtualenvwrapper-on-macos" target="_blank" rel="noopener">https://stackoverflow.com/questions/49470367/install-virtualenv-and-virtualenvwrapper-on-macos</a></p>
<h4 id="settings">settings</h4>
<h4 id="models设计数据表">models设计数据表</h4>
<h4 id="url设计">url设计</h4>
<h4 id="视图views业务逻辑代码">视图（views）业务逻辑代码</h4>
<p>当用户发起的请求匹配上某条url路由规则，用户请求就会被转发到对应的视图函数中处理。</p>
<p>我们可以在视图函数中对请求参数进行处理，按照业务逻辑完成相关操作（如数据查询、变更等），最后返回响应。</p>
<h5 id="数据查询">数据查询</h5>
<p>http://127.0.0.1:8000/map_basic/provinces/</p>
<ul>
<li>以列表形式返回结果集</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">province_objs</span> <span class="o">=</span> <span class="n">Province</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/interface/values_list_hue66480ad92d1634b2ede582b4f625477_205511_ad4ea57a79efde63134f5f29a2ac38c3.webp 400w,
               /post/django-core-techs-notes/images/interface/values_list_hue66480ad92d1634b2ede582b4f625477_205511_b06a553d951f713012512e1fdc9d8fee.webp 760w,
               /post/django-core-techs-notes/images/interface/values_list_hue66480ad92d1634b2ede582b4f625477_205511_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/interface/values_list_hue66480ad92d1634b2ede582b4f625477_205511_ad4ea57a79efde63134f5f29a2ac38c3.webp"
               width="547"
               height="760"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<ul>
<li>以字典方式返回结果集</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">province_objs</span> <span class="o">=</span> <span class="n">Province</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;code&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/interface/values_origin_hu479134e91543edc6d7cd94a33cb8219f_242204_83f44a43d7c78c8514851a88bcc7f1a2.webp 400w,
               /post/django-core-techs-notes/images/interface/values_origin_hu479134e91543edc6d7cd94a33cb8219f_242204_66ca3558ccac02bc739fe195fe824c71.webp 760w,
               /post/django-core-techs-notes/images/interface/values_origin_hu479134e91543edc6d7cd94a33cb8219f_242204_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/interface/values_origin_hu479134e91543edc6d7cd94a33cb8219f_242204_83f44a43d7c78c8514851a88bcc7f1a2.webp"
               width="494"
               height="760"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h6 id="聚合查询">聚合查询</h6>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"> <span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>
</span></span><span class="line"><span class="cl"> <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"> <span class="c1"># 按照省份名称过滤记录</span>
</span></span><span class="line"><span class="cl"> <span class="n">museum_province_queryset</span> <span class="o">=</span> <span class="n">Museum</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">province_name</span><span class="o">=</span><span class="n">province_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;city_name&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 分组统计每个地级市有多少条记录（博物馆数量）</span>
</span></span><span class="line"><span class="cl"> <span class="n">province_count_set</span> <span class="o">=</span> <span class="n">museum_province_queryset</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s2">&#34;city_name&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/query/agg/group_and_count_hu98a27c4132a42b6d2d1663c7f19e2ae1_331132_51da20d5372d98db94cb4cf51e17a72f.webp 400w,
               /post/django-core-techs-notes/images/query/agg/group_and_count_hu98a27c4132a42b6d2d1663c7f19e2ae1_331132_c18f9decc83c7201b4ae5af72ea46242.webp 760w,
               /post/django-core-techs-notes/images/query/agg/group_and_count_hu98a27c4132a42b6d2d1663c7f19e2ae1_331132_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/query/agg/group_and_count_hu98a27c4132a42b6d2d1663c7f19e2ae1_331132_51da20d5372d98db94cb4cf51e17a72f.webp"
               width="673"
               height="760"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h4 id="django应用目录结构">Django应用目录结构</h4>
<p>默认来说，使用django-admin startapp命令新建的应用目录会在第一层，在应用数量较多的时候可能并不美观，因此需要重组应用的目录结构。</p>
<p>比如，新建apps目录，用于放置django应用，然后需要在settings文件中将apps目录添加到搜索路径确保django服务能找到应用代码.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s2">&#34;apps&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>对应的，settings.py中的INSTALLED_APP需要进行修改：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;django.contrib.gis&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django_admin_listfilter_dropdown&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;apps.map_basic&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h4 id="template-html生成">template html生成</h4>
<p>pass</p>
<h2 id="0x01-django项目实战">0x01 Django项目实战</h2>
<h3 id="创建django项目">创建Django项目</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">django-admin startproject Message
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> Message
</span></span><span class="line"><span class="cl">django-admin startapp message_form 
</span></span></code></pre></div><h3 id="配置后台管理站点">配置后台管理站点</h3>
<h4 id="后台管理站点的地址">后台管理站点的地址</h4>
<p>默认来说，后台管理系统的地址为：http://127.0.0.1:8000/admin,这是在主应用的urls.py配置的路由，当然我们也可以进行改动：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_urls_default_hu7453c03dbe49a5f8f83de50182a6dfae_163883_c7e1a76d74cee24c7c800662ac3cb25e.webp 400w,
               /post/django-core-techs-notes/images/admin_urls_default_hu7453c03dbe49a5f8f83de50182a6dfae_163883_28e559ec3878a11d16f417310ce5a4c5.webp 760w,
               /post/django-core-techs-notes/images/admin_urls_default_hu7453c03dbe49a5f8f83de50182a6dfae_163883_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_urls_default_hu7453c03dbe49a5f8f83de50182a6dfae_163883_c7e1a76d74cee24c7c800662ac3cb25e.webp"
               width="760"
               height="638"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h4 id="中间件">中间件</h4>
<p>Django的中间件是对Django请求/响应处理的一种框架，是一种轻量级的“插件”系统，用于全局处理Django的输入或输出。比如默认Django项目注册了如下中间件：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/setting_middle_hu2f310da0ffa3f3a90ba7f0f2fbf3e6d8_104771_0501c4e343359eb0efab053c00ecd743.webp 400w,
               /post/django-core-techs-notes/images/middlewares/setting_middle_hu2f310da0ffa3f3a90ba7f0f2fbf3e6d8_104771_6bf89c3f2aa81a7df72c27aac0bbd3f7.webp 760w,
               /post/django-core-techs-notes/images/middlewares/setting_middle_hu2f310da0ffa3f3a90ba7f0f2fbf3e6d8_104771_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/setting_middle_hu2f310da0ffa3f3a90ba7f0f2fbf3e6d8_104771_0501c4e343359eb0efab053c00ecd743.webp"
               width="760"
               height="344"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h5 id="securitymiddleware">SecurityMiddleware</h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span>
</span></span><span class="line"><span class="cl">            <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">is_secure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_exempt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_host</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">get_host</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">HttpResponsePermanentRedirect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;https://</span><span class="si">%s%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></div><h5 id="heading"></h5>
<h5 id="commonmiddlewarehttpsdocsdjangoprojectcomen42refmiddlewaredjangomiddlewarecommoncommonmiddleware"><a href="https://docs.djangoproject.com/en/4.2/ref/middleware/#django.middleware.common.CommonMiddleware" target="_blank" rel="noopener">CommonMiddleware</a></h5>
<p>启用该中间件后，每一个请求经过中间件时，会经如下函数进行处理:比如检查用户的USER_AGENT是否在黑名单，是否应该进行重定向等。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Check for denied User-Agents and rewrite the URL based on
</span></span></span><span class="line"><span class="cl"><span class="s2">        settings.APPEND_SLASH and settings.PREPEND_WWW
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for denied User-Agents</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_agent</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;HTTP_USER_AGENT&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">user_agent_regex</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">DISALLOWED_USER_AGENTS</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">user_agent_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">user_agent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="k">raise</span> <span class="n">PermissionDenied</span><span class="p">(</span><span class="s2">&#34;Forbidden user agent&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for a redirect based on settings.PREPEND_WWW</span>
</span></span><span class="line"><span class="cl">        <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_host</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">PREPEND_WWW</span> <span class="ow">and</span> <span class="n">host</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">host</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;www.&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if we also need to append a slash so we can do it all</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># with a single redirect. (This check may be somewhat expensive,</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># so we only do it if we already know we&#39;re sending a redirect,</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># or in process_response if we get a 404.)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_redirect_with_slash</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_path_with_slash</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_redirect_class</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://www.</span><span class="si">{</span><span class="n">host</span><span class="si">}{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>以USER_AGENT检查为例，默认情况下Django的配置文件没有设置user-agent黑名单，此时使用curl或者python发起请求接口均可正常返回数据。</p>
<ul>
<li>curl请求接口</li>
</ul>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/curl_useragent_hu3300d9ae70baa4a072c693425a81da03_225080_6bd6375b14ccccb56137fb3344ce4a65.webp 400w,
               /post/django-core-techs-notes/images/middlewares/curl_useragent_hu3300d9ae70baa4a072c693425a81da03_225080_8676e7be4106d7caf9872f59736a640d.webp 760w,
               /post/django-core-techs-notes/images/middlewares/curl_useragent_hu3300d9ae70baa4a072c693425a81da03_225080_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/curl_useragent_hu3300d9ae70baa4a072c693425a81da03_225080_6bd6375b14ccccb56137fb3344ce4a65.webp"
               width="760"
               height="296"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/common_useragent_hu2d512a70c99618df80daeec9792a009a_304260_3759334d34c63a1b97b0b4b470d731e2.webp 400w,
               /post/django-core-techs-notes/images/middlewares/common_useragent_hu2d512a70c99618df80daeec9792a009a_304260_4a12333c34f45999c51e53693a61b270.webp 760w,
               /post/django-core-techs-notes/images/middlewares/common_useragent_hu2d512a70c99618df80daeec9792a009a_304260_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/common_useragent_hu2d512a70c99618df80daeec9792a009a_304260_3759334d34c63a1b97b0b4b470d731e2.webp"
               width="760"
               height="376"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<ul>
<li>python requests</li>
</ul>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/python-req_hu48f3f8fa315ebb2a311768442e07ae9c_164804_d6fbd9641d2d3a4a5e03700db9fafcbd.webp 400w,
               /post/django-core-techs-notes/images/middlewares/python-req_hu48f3f8fa315ebb2a311768442e07ae9c_164804_3db7c563055daf0b1b49741dbae1224d.webp 760w,
               /post/django-core-techs-notes/images/middlewares/python-req_hu48f3f8fa315ebb2a311768442e07ae9c_164804_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/python-req_hu48f3f8fa315ebb2a311768442e07ae9c_164804_d6fbd9641d2d3a4a5e03700db9fafcbd.webp"
               width="760"
               height="234"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/python-requests-useragent_hu912ae8fda024c168b110ac59157a187c_124833_3ac97fc0d5adc2ceafc37f2417f9985b.webp 400w,
               /post/django-core-techs-notes/images/middlewares/python-requests-useragent_hu912ae8fda024c168b110ac59157a187c_124833_f18e3a6b6c689552163cfaf86b01293b.webp 760w,
               /post/django-core-techs-notes/images/middlewares/python-requests-useragent_hu912ae8fda024c168b110ac59157a187c_124833_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/python-requests-useragent_hu912ae8fda024c168b110ac59157a187c_124833_3ac97fc0d5adc2ceafc37f2417f9985b.webp"
               width="760"
               height="290"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>如果想要禁止具有特定USERAGENT的请求访问接口，可以在SETTINGS文件中配置黑名单settings.DISALLOWED_USER_AGENTS</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">DISALLOWED_USER_AGENTS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;curl&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;python&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>配置成功后，当请求的user-agent匹配上黑名单的其中一项，请求就会被拒绝，如下图所示：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/python-req-forbidden_hu39be39548a57ff5129497e598936dafc_26724_08b91c7321621f68cc6152c836aef11d.webp 400w,
               /post/django-core-techs-notes/images/middlewares/python-req-forbidden_hu39be39548a57ff5129497e598936dafc_26724_f06966fa9398665b9a4e6981ddc45aef.webp 760w,
               /post/django-core-techs-notes/images/middlewares/python-req-forbidden_hu39be39548a57ff5129497e598936dafc_26724_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/python-req-forbidden_hu39be39548a57ff5129497e598936dafc_26724_08b91c7321621f68cc6152c836aef11d.webp"
               width="760"
               height="36"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/curl-forbidden_hu0d97dfd8af0ca5f97caddf5c7c49bc80_116612_cc24d79440015cbbfdd362a7e719db4e.webp 400w,
               /post/django-core-techs-notes/images/middlewares/curl-forbidden_hu0d97dfd8af0ca5f97caddf5c7c49bc80_116612_d582bc143e9aede64a82f16a88a06c76.webp 760w,
               /post/django-core-techs-notes/images/middlewares/curl-forbidden_hu0d97dfd8af0ca5f97caddf5c7c49bc80_116612_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/curl-forbidden_hu0d97dfd8af0ca5f97caddf5c7c49bc80_116612_cc24d79440015cbbfdd362a7e719db4e.webp"
               width="760"
               height="305"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>当然，默认情况下，编译的正则表达式不区分大小写，如果需要区分，可以在编译正则表达式时加上re.IGNORECASE参数。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># User-Agent黑名单，编译过的正则表达式, 同时配置不区分大小写</span>
</span></span><span class="line"><span class="cl"><span class="n">DISALLOWED_USER_AGENTS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;curl&#34;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;python&#34;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;PhantomJS&#34;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;selenium&#34;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&#34;java&#34;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>当然，如果仅按上述配置设置user agent黑名单，那么随便构造一个user-agent即可绕过该限制，如：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/user-agent-random_huc90c01de2a157037419f45d72979001f_151932_6e7f7275aa1d3d05f8227a6748d494af.webp 400w,
               /post/django-core-techs-notes/images/middlewares/user-agent-random_huc90c01de2a157037419f45d72979001f_151932_beb9ace5c19f7fc8db3a4c34812c77eb.webp 760w,
               /post/django-core-techs-notes/images/middlewares/user-agent-random_huc90c01de2a157037419f45d72979001f_151932_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/user-agent-random_huc90c01de2a157037419f45d72979001f_151932_6e7f7275aa1d3d05f8227a6748d494af.webp"
               width="760"
               height="132"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>如果具有反爬虫的需求，实现时可能还需要以黑名单结合白名单的方式进行才能达到好的效果。</p>
<h5 id="csrfviewmiddlewarehttpsdocsdjangoprojectcomen42refmiddlewarecsrf-protection-middleware"><a href="https://docs.djangoproject.com/en/4.2/ref/middleware/#csrf-protection-middleware" target="_blank" rel="noopener">CsrfViewMiddleware</a></h5>
<h5 id="authenticationmiddlewarehttpsdocsdjangoprojectcomen42refmiddlewaredjangocontribauthmiddlewareauthenticationmiddleware"><a href="https://docs.djangoproject.com/en/4.2/ref/middleware/#django.contrib.auth.middleware.AuthenticationMiddleware" target="_blank" rel="noopener">AuthenticationMiddleware</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span>
</span></span><span class="line"><span class="cl">            <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">is_secure</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="ow">and</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_exempt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_host</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">get_host</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">HttpResponsePermanentRedirect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;https://</span><span class="si">%s%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">get_full_path</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span></code></pre></div><ul>
<li>&hellip;</li>
</ul>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/order_hu44b8e08f1af7e7cc23d41f8cf0f5dc72_609823_0b3318206fd76c94117f111d525977b3.webp 400w,
               /post/django-core-techs-notes/images/middlewares/order_hu44b8e08f1af7e7cc23d41f8cf0f5dc72_609823_db3e3d8e278566e802a4cddb528dbb12.webp 760w,
               /post/django-core-techs-notes/images/middlewares/order_hu44b8e08f1af7e7cc23d41f8cf0f5dc72_609823_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/order_hu44b8e08f1af7e7cc23d41f8cf0f5dc72_609823_0b3318206fd76c94117f111d525977b3.webp"
               width="361"
               height="760"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h5 id="自定义中间件-反爬虫">自定义中间件-反爬虫</h5>
<p>反爬虫通常需要考虑user-agent、ip访问频率等参数。</p>
<p>通过新建并注册一个专门用于判断爬虫特征的中间件并适当给予拦截是接口服务的一项重要需求。</p>
<p>先以简单的ip访问频率限制为例，如果同一个ip前后两次的访问时间差小于某个阈值，我们直接返回响应，提示其应该降低频率，如果确定为恶意爬虫，可以将ip加入黑名单。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.utils.deprecation</span> <span class="kn">import</span> <span class="n">MiddlewareMixin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AntiCrawlMiddleware</span><span class="p">(</span><span class="n">MiddlewareMixin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">last_id</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">last_time</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;反爬虫中间件&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># request META &#39;HTTP_USER_AGENT&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 针对USER_AGENT的拦截已经在common.py的CommonMiddleware有实现</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># IP访问频率限制</span>
</span></span><span class="line"><span class="cl">        <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">META</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;REMOTE_ADDR&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">ip</span> <span class="o">==</span> <span class="n">AntiCrawlMiddleware</span><span class="o">.</span><span class="n">last_id</span> <span class="ow">and</span> <span class="n">now</span> <span class="o">-</span> <span class="n">AntiCrawlMiddleware</span><span class="o">.</span><span class="n">last_time</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;your visit frequency is too high, please try again later.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">AntiCrawlMiddleware</span><span class="o">.</span><span class="n">last_id</span> <span class="o">=</span> <span class="n">ip</span>
</span></span><span class="line"><span class="cl">        <span class="n">AntiCrawlMiddleware</span><span class="o">.</span><span class="n">last_time</span> <span class="o">=</span> <span class="n">now</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py</span>
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 反爬虫中间件</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;middlewares.anticrawl.AntiCrawlMiddleware&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>服务启用以上中间件后，尝试用脚本对接口进行高频请求，可见确实有限制效果。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/ip_visit_freq_hubebd73fa21488d8d41c78f7939c293b0_226141_9181c2563b952608a235a7f0f2376f73.webp 400w,
               /post/django-core-techs-notes/images/middlewares/ip_visit_freq_hubebd73fa21488d8d41c78f7939c293b0_226141_b5040d9feefc6e87ff9bc854ee709d43.webp 760w,
               /post/django-core-techs-notes/images/middlewares/ip_visit_freq_hubebd73fa21488d8d41c78f7939c293b0_226141_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/ip_visit_freq_hubebd73fa21488d8d41c78f7939c293b0_226141_9181c2563b952608a235a7f0f2376f73.webp"
               width="760"
               height="277"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>注，以上仅为示例代码，实际工程化可以结合缓存数据库存储访问ip相关信息，而非局限于当前ip==上次访问ip的情形。</p>
<p>也有一些专门用于反爬虫的库<a href="https://pypi.org/project/django-anti-crawler/" target="_blank" rel="noopener">django-anti-crawler · PyPI</a></p>
<h6 id="校验cookie的值决定是否进行响应">校验COOKIE的值决定是否进行响应</h6>
<p>在中间件的process_request方法中, 获取cookie值并进行校验，以下是一个简单的示例例子，只要cookie中不存在token，即认为请求非法，不予返回接口数据。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">process_request</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Cookie反爬，以token为例</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;cookies&#34;</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">COOKIES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;token&#34;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 如果token为None 可以考虑重定向到某一个页面</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># return redirect(&#34;https://www.baidu.com&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># return HttpResponseRedirect(&#34;your visit is illegal.&#34;)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 示例；直接返回错误响应</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&#34;your visit is illegal.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>使用postman发送请求（无cookie）</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/cookie-none_huc492b1cd9e13df4c97a41363c6b0db2d_116973_1d85955579721aae144528ac97b9e33c.webp 400w,
               /post/django-core-techs-notes/images/middlewares/cookie-none_huc492b1cd9e13df4c97a41363c6b0db2d_116973_53288b2b8fcde6fd1b5a09bc538b8973.webp 760w,
               /post/django-core-techs-notes/images/middlewares/cookie-none_huc492b1cd9e13df4c97a41363c6b0db2d_116973_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/cookie-none_huc492b1cd9e13df4c97a41363c6b0db2d_116973_1d85955579721aae144528ac97b9e33c.webp"
               width="760"
               height="426"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>使用postman发送请求（附带cookie)</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/random_token_hu81814c6c89274febc3fbb6ce9acd73ee_83770_5b570d167de54d7bfbcba766c5d00975.webp 400w,
               /post/django-core-techs-notes/images/middlewares/random_token_hu81814c6c89274febc3fbb6ce9acd73ee_83770_20ca40c2261b41bcfbf39170e5162a87.webp 760w,
               /post/django-core-techs-notes/images/middlewares/random_token_hu81814c6c89274febc3fbb6ce9acd73ee_83770_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/random_token_hu81814c6c89274febc3fbb6ce9acd73ee_83770_5b570d167de54d7bfbcba766c5d00975.webp"
               width="760"
               height="476"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/random-cookie-test_hu4589366d08f83e4f1dda47b61e10b67b_138615_f0fd44270be94e240b06125caef8a7f4.webp 400w,
               /post/django-core-techs-notes/images/middlewares/random-cookie-test_hu4589366d08f83e4f1dda47b61e10b67b_138615_0995d93b18017e6639221e595c5bd80d.webp 760w,
               /post/django-core-techs-notes/images/middlewares/random-cookie-test_hu4589366d08f83e4f1dda47b61e10b67b_138615_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/random-cookie-test_hu4589366d08f83e4f1dda47b61e10b67b_138615_f0fd44270be94e240b06125caef8a7f4.webp"
               width="760"
               height="474"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/middlewares/random-cookie_huf3517e300b5061d0fc42606eeecfd7e7_147271_2fbb591801ef88536b89feed291cfdc8.webp 400w,
               /post/django-core-techs-notes/images/middlewares/random-cookie_huf3517e300b5061d0fc42606eeecfd7e7_147271_92cfc7d2e04893df3670c241f91a32d4.webp 760w,
               /post/django-core-techs-notes/images/middlewares/random-cookie_huf3517e300b5061d0fc42606eeecfd7e7_147271_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/middlewares/random-cookie_huf3517e300b5061d0fc42606eeecfd7e7_147271_2fbb591801ef88536b89feed291cfdc8.webp"
               width="760"
               height="544"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h4 id="后台管理用户">后台管理用户</h4>
<p>创建管理用户，并配置密码（不可为空）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">python manage.py createsuperuser
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/createsuperuser_hue8e0f180e3232b68693c41e9421621fd_65583_d828d1ddde200027205d4f65cca92b95.webp 400w,
               /post/django-core-techs-notes/images/createsuperuser_hue8e0f180e3232b68693c41e9421621fd_65583_aa8c3d5194fe210166b5e5687e898d14.webp 760w,
               /post/django-core-techs-notes/images/createsuperuser_hue8e0f180e3232b68693c41e9421621fd_65583_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/createsuperuser_hue8e0f180e3232b68693c41e9421621fd_65583_d828d1ddde200027205d4f65cca92b95.webp"
               width="760"
               height="193"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/django_admin_hub987700d99b42fd00a0820bfd3651666_182428_96feca9d77f84ccc63d83e8e12ab1799.webp 400w,
               /post/django-core-techs-notes/images/django_admin_hub987700d99b42fd00a0820bfd3651666_182428_41175c1c809d386086567bbe933a4ff7.webp 760w,
               /post/django-core-techs-notes/images/django_admin_hub987700d99b42fd00a0820bfd3651666_182428_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/django_admin_hub987700d99b42fd00a0820bfd3651666_182428_96feca9d77f84ccc63d83e8e12ab1799.webp"
               width="760"
               height="464"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>默认django后台使用英文，只需要在settings.py文件修改语言配置即可实现中文的后台管理系统。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/django_lang_huf5131db57544c0388101564186c19430_152441_867ca7fa8b632d87d1d3237d16ec31be.webp 400w,
               /post/django-core-techs-notes/images/django_lang_huf5131db57544c0388101564186c19430_152441_dfaa12c25e20c606b7533f67d4cac4f0.webp 760w,
               /post/django-core-techs-notes/images/django_lang_huf5131db57544c0388101564186c19430_152441_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/django_lang_huf5131db57544c0388101564186c19430_152441_867ca7fa8b632d87d1d3237d16ec31be.webp"
               width="760"
               height="414"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/django_admin_zh_hu1b107e55c6f87777de10cb072245fc97_168119_2ba608304ad87b834886e772ed330d25.webp 400w,
               /post/django-core-techs-notes/images/django_admin_zh_hu1b107e55c6f87777de10cb072245fc97_168119_78a6773323b6d2097c42aee4aba0b826.webp 760w,
               /post/django-core-techs-notes/images/django_admin_zh_hu1b107e55c6f87777de10cb072245fc97_168119_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/django_admin_zh_hu1b107e55c6f87777de10cb072245fc97_168119_2ba608304ad87b834886e772ed330d25.webp"
               width="760"
               height="409"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>对于开发者自定义的app，只要加入settings.py文件中的INSTALLED_APP列表，django就会自动搜索这些app的admin模块，将app纳入后台管理系统</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/settings_installed_app_hu513d120415cb580237dc98c9ee60602e_65261_6f6f831d4ed0b140f15c41734f99c6be.webp 400w,
               /post/django-core-techs-notes/images/settings_installed_app_hu513d120415cb580237dc98c9ee60602e_65261_6a09cadd77bdcbdab1f9562b2e834316.webp 760w,
               /post/django-core-techs-notes/images/settings_installed_app_hu513d120415cb580237dc98c9ee60602e_65261_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/settings_installed_app_hu513d120415cb580237dc98c9ee60602e_65261_6f6f831d4ed0b140f15c41734f99c6be.webp"
               width="760"
               height="502"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>在admin.py中注册Model</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_reg_hu3f162b52c4c6609c7f81d29b89ab8895_26273_395514c101d8e2db7338bd0d85985faf.webp 400w,
               /post/django-core-techs-notes/images/admin_reg_hu3f162b52c4c6609c7f81d29b89ab8895_26273_64caabb6b25bb31d1ee133fddbdb1f96.webp 760w,
               /post/django-core-techs-notes/images/admin_reg_hu3f162b52c4c6609c7f81d29b89ab8895_26273_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_reg_hu3f162b52c4c6609c7f81d29b89ab8895_26273_395514c101d8e2db7338bd0d85985faf.webp"
               width="760"
               height="174"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/django_admin_app_hu7dff627c43a63abb2996cf9cb5432ef6_73926_47c4efb4d033542bf993492441d94cbe.webp 400w,
               /post/django-core-techs-notes/images/django_admin_app_hu7dff627c43a63abb2996cf9cb5432ef6_73926_0c9df8a4288685f3ef3e1808c5ee2091.webp 760w,
               /post/django-core-techs-notes/images/django_admin_app_hu7dff627c43a63abb2996cf9cb5432ef6_73926_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/django_admin_app_hu7dff627c43a63abb2996cf9cb5432ef6_73926_47c4efb4d033542bf993492441d94cbe.webp"
               width="760"
               height="426"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h4 id="后台管理配置项">后台管理配置项</h4>
<h5 id="表名字段名可读性配置">表名、字段名可读性配置</h5>
<p>默认来说，后台会以英文（复数形式）展示Model，如果需要自定义配置，可以在Model类的Meta类中修改单数形式和复数形式的昵称。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/model_verbose_hu7ccadebd52a1b7252600a3242b1d0f49_162226_15ac646b27220962dedf14f3a015e944.webp 400w,
               /post/django-core-techs-notes/images/model_verbose_hu7ccadebd52a1b7252600a3242b1d0f49_162226_24c4ec266cf49d0b314be0272d746592.webp 760w,
               /post/django-core-techs-notes/images/model_verbose_hu7ccadebd52a1b7252600a3242b1d0f49_162226_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/model_verbose_hu7ccadebd52a1b7252600a3242b1d0f49_162226_15ac646b27220962dedf14f3a015e944.webp"
               width="760"
               height="308"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/model_field_verbose_hu646f63462a6ec58ddffc51a7e6b71e98_135769_1f6d888d4fd88734fc0dcfe5ae026d07.webp 400w,
               /post/django-core-techs-notes/images/model_field_verbose_hu646f63462a6ec58ddffc51a7e6b71e98_135769_26d19bc0d548b11f663be0b8b55ea4a7.webp 760w,
               /post/django-core-techs-notes/images/model_field_verbose_hu646f63462a6ec58ddffc51a7e6b71e98_135769_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/model_field_verbose_hu646f63462a6ec58ddffc51a7e6b71e98_135769_1f6d888d4fd88734fc0dcfe5ae026d07.webp"
               width="760"
               height="148"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_verbose_hu5730be0e4ef6a2505e6c28aca9d6793e_23412_7277dd3ff3d1101597fafaf995504068.webp 400w,
               /post/django-core-techs-notes/images/admin_verbose_hu5730be0e4ef6a2505e6c28aca9d6793e_23412_08798d0191f6f0e7d9c036ce9403fbc2.webp 760w,
               /post/django-core-techs-notes/images/admin_verbose_hu5730be0e4ef6a2505e6c28aca9d6793e_23412_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_verbose_hu5730be0e4ef6a2505e6c28aca9d6793e_23412_7277dd3ff3d1101597fafaf995504068.webp"
               width="626"
               height="356"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h5 id="支持按字段搜索">支持按字段搜索</h5>
<p>需要自定义admin.ModelAdmin的子类，配置search_fields（搜索字段）</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_search_config_hu60cbb60562289e5f558cbc8c2e9f45bd_44999_7d358f51801a3cbd243de4e2dd4c83e6.webp 400w,
               /post/django-core-techs-notes/images/admin_search_config_hu60cbb60562289e5f558cbc8c2e9f45bd_44999_9ae272dfe87606211e097cb9e75fb901.webp 760w,
               /post/django-core-techs-notes/images/admin_search_config_hu60cbb60562289e5f558cbc8c2e9f45bd_44999_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_search_config_hu60cbb60562289e5f558cbc8c2e9f45bd_44999_7d358f51801a3cbd243de4e2dd4c83e6.webp"
               width="760"
               height="150"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_search_field_hu7c71c88d0ecd934746b7aeb48c48cb33_76844_3023ff42ed7fd3c2615d734cd4ae1219.webp 400w,
               /post/django-core-techs-notes/images/admin_search_field_hu7c71c88d0ecd934746b7aeb48c48cb33_76844_63e54302a16a45ca0a50b1fabeadb8bd.webp 760w,
               /post/django-core-techs-notes/images/admin_search_field_hu7c71c88d0ecd934746b7aeb48c48cb33_76844_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_search_field_hu7c71c88d0ecd934746b7aeb48c48cb33_76844_3023ff42ed7fd3c2615d734cd4ae1219.webp"
               width="760"
               height="429"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h5 id="更多配置">更多配置</h5>
<p>配置展示的字段、是否以列表形式展示、列表过滤器、排序字段等。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_config/model_admin_config_hu4f96c369cd0049552a1a93b7414ac6d5_123582_7da7038e0865c7f4cdd17b5213798bd0.webp 400w,
               /post/django-core-techs-notes/images/admin_config/model_admin_config_hu4f96c369cd0049552a1a93b7414ac6d5_123582_de491bfcf2eeb1096daba99ae2eefafb.webp 760w,
               /post/django-core-techs-notes/images/admin_config/model_admin_config_hu4f96c369cd0049552a1a93b7414ac6d5_123582_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_config/model_admin_config_hu4f96c369cd0049552a1a93b7414ac6d5_123582_7da7038e0865c7f4cdd17b5213798bd0.webp"
               width="760"
               height="291"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_config/admin_config_hu4f53d45506b51596b673426f0e395a4d_401304_ada66d852ec5075742a4a1464f9495ef.webp 400w,
               /post/django-core-techs-notes/images/admin_config/admin_config_hu4f53d45506b51596b673426f0e395a4d_401304_96fbd699f23a4c538146b798533f4cf9.webp 760w,
               /post/django-core-techs-notes/images/admin_config/admin_config_hu4f53d45506b51596b673426f0e395a4d_401304_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_config/admin_config_hu4f53d45506b51596b673426f0e395a4d_401304_ada66d852ec5075742a4a1464f9495ef.webp"
               width="587"
               height="760"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>如果对过滤器样式有更多要求，可以参考: <a href="https://stackoverflow.com/questions/5429276/how-to-change-the-django-admin-filter-to-use-a-dropdown-instead-of-list" target="_blank" rel="noopener">How to change the Django admin filter to use a dropdown instead of list? - Stack Overflow</a></p>
<p>比如，需要下拉式过滤器,可安装扩展django_admin_listfilter_dropdown，在配置文件中配置APP，即可导入相关过滤器使用</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django_admin_listfilter_dropdown.filters</span> <span class="kn">import</span> <span class="p">(</span><span class="n">DropdownFilter</span><span class="p">,</span> <span class="n">ChoiceDropdownFilter</span><span class="p">,</span> <span class="n">RelatedDropdownFilter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CountyAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 配置展示什么字段</span>
</span></span><span class="line"><span class="cl">    <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;provincena&#39;</span><span class="p">,</span> <span class="s1">&#39;city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;shape_leng&#39;</span><span class="p">,</span> <span class="s1">&#39;shape_area&#39;</span><span class="p">,</span> <span class="s1">&#39;geo&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 以列表的形式展示表数据</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_display</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;provincena&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;shape_area&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 可搜索的字段</span>
</span></span><span class="line"><span class="cl">    <span class="n">search_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;provincena&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 过滤字段: https://docs.djangoproject.com/en/4.2/ref/contrib/admin/filters/</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># list_filter = (&#39;provincena&#39;, &#39;city_name&#39;)</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_filter</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s1">&#39;provincena&#39;</span><span class="p">,</span> <span class="n">DropdownFilter</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="s1">&#39;city_name&#39;</span><span class="p">,</span> <span class="n">DropdownFilter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 排序字段</span>
</span></span><span class="line"><span class="cl">    <span class="n">ordering</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&#34;-shape_area&#34;</span><span class="p">,)</span>
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_config/dropdown_filter_hu6f3462bd84b02df2b2c66b8ffba8c14d_189950_73c89e75829b1146a9a7adb99f042e22.webp 400w,
               /post/django-core-techs-notes/images/admin_config/dropdown_filter_hu6f3462bd84b02df2b2c66b8ffba8c14d_189950_b094112da98ab0b645e0a00f58958a4b.webp 760w,
               /post/django-core-techs-notes/images/admin_config/dropdown_filter_hu6f3462bd84b02df2b2c66b8ffba8c14d_189950_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_config/dropdown_filter_hu6f3462bd84b02df2b2c66b8ffba8c14d_189950_73c89e75829b1146a9a7adb99f042e22.webp"
               width="760"
               height="697"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>models.py中的Model字段属性定义会影响数据在后台管理系统的显示，如verbose_name，浮点类型的显示小数位数等。</p>
<h5 id="禁用删除权限">禁用删除权限</h5>
<p>默认django admin表管理界面可以删除数据.</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_config/default_delete_hua9e1ad6d7abdcd1b9e485319d686465e_36084_54eb633605c599cd8b5637df83ff42cc.webp 400w,
               /post/django-core-techs-notes/images/admin_config/default_delete_hua9e1ad6d7abdcd1b9e485319d686465e_36084_f401d3c4d2abe23df2fb23c84d1d6f68.webp 760w,
               /post/django-core-techs-notes/images/admin_config/default_delete_hua9e1ad6d7abdcd1b9e485319d686465e_36084_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_config/default_delete_hua9e1ad6d7abdcd1b9e485319d686465e_36084_54eb633605c599cd8b5637df83ff42cc.webp"
               width="760"
               height="150"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>可以通过重写对应的Admin子类的has_delete_permission方法禁用删除权限。</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/admin_config/disable_delete_hu7cef8b37358fc9e140ec8c4f5ffbd469_94071_26f573c8f62e70811a3a529772d46557.webp 400w,
               /post/django-core-techs-notes/images/admin_config/disable_delete_hu7cef8b37358fc9e140ec8c4f5ffbd469_94071_099459e8c30fe239b6242756226f3218.webp 760w,
               /post/django-core-techs-notes/images/admin_config/disable_delete_hu7cef8b37358fc9e140ec8c4f5ffbd469_94071_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/admin_config/disable_delete_hu7cef8b37358fc9e140ec8c4f5ffbd469_94071_26f573c8f62e70811a3a529772d46557.webp"
               width="760"
               height="538"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h5 id="地理空间要素模型配置地图底图图层">地理空间要素模型配置地图底图图层</h5>
<p>以下为django.contrib.gis.admin提供的默认地理要素管理类，也可以参照其中配置自定义图层服务，如使用高德地图、百度地图。</p>
<ul>
<li>
<p>GeoModelAdmin</p>
<p>默认使用openlayer在线地图服务</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># RemovedInDjango50Warning.</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">GeoModelAdmin</span><span class="p">(</span><span class="n">ModelAdmin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    The administration options class for Geographic models. Map settings
</span></span></span><span class="line"><span class="cl"><span class="s2">    may be overloaded from their defaults to create custom maps.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># The default map settings that may be overloaded -- still subject</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># to API changes.</span>
</span></span><span class="line"><span class="cl">    <span class="n">default_lon</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">default_lat</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">default_zoom</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="n">display_wkt</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">display_srid</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">extra_js</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_zoom</span> <span class="o">=</span> <span class="mi">18</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_zoom</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">min_zoom</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">units</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_resolution</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_extent</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">modifiable</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">mouse_position</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">scale_text</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">layerswitcher</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">scrollable</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">map_width</span> <span class="o">=</span> <span class="mi">600</span>
</span></span><span class="line"><span class="cl">    <span class="n">map_height</span> <span class="o">=</span> <span class="mi">400</span>
</span></span><span class="line"><span class="cl">    <span class="n">map_srid</span> <span class="o">=</span> <span class="mi">4326</span>
</span></span><span class="line"><span class="cl">    <span class="n">map_template</span> <span class="o">=</span> <span class="s2">&#34;gis/admin/openlayers.html&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">openlayers_url</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://cdnjs.cloudflare.com/ajax/libs/openlayers/2.13.1/OpenLayers.js&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">point_zoom</span> <span class="o">=</span> <span class="n">num_zoom</span> <span class="o">-</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl">    <span class="n">wms_url</span> <span class="o">=</span> <span class="s2">&#34;http://vmap0.tiles.osgeo.org/wms/vmap0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">wms_layer</span> <span class="o">=</span> <span class="s2">&#34;basic&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">wms_name</span> <span class="o">=</span> <span class="s2">&#34;OpenLayers WMS&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">wms_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;format&#34;</span><span class="p">:</span> <span class="s2">&#34;image/jpeg&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="n">widget</span> <span class="o">=</span> <span class="n">OpenLayersWidget</span>
</span></span></code></pre></div></li>
<li>
<p>OSMModelAdmin</p>
<p>默认使用OSM在线地图服务</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># RemovedInDjango50Warning.</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OSMGeoAdmin</span><span class="p">(</span><span class="n">GeoModelAdmin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">map_template</span> <span class="o">=</span> <span class="s2">&#34;gis/admin/osm.html&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_zoom</span> <span class="o">=</span> <span class="mi">20</span>
</span></span><span class="line"><span class="cl">    <span class="n">map_srid</span> <span class="o">=</span> <span class="n">spherical_mercator_srid</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_extent</span> <span class="o">=</span> <span class="s2">&#34;-20037508,-20037508,20037508,20037508&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_resolution</span> <span class="o">=</span> <span class="s2">&#34;156543.0339&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">point_zoom</span> <span class="o">=</span> <span class="n">num_zoom</span> <span class="o">-</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl">    <span class="n">units</span> <span class="o">=</span> <span class="s2">&#34;m&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>GISModelAdmin</p>
</li>
<li>
<p>&hellip;</p>
</li>
</ul>
<h5 id="地理空间要素数据多图层叠加管理">地理空间要素数据多图层叠加管理</h5>
<p>尚未查阅，不知是否有相关现成工具。</p>
<h4 id="后台管理界面主题">后台管理界面主题</h4>
<p><a href="https://djangopackages.org/grids/g/admin-styling/" target="_blank" rel="noopener">https://djangopackages.org/grids/g/admin-styling/</a></p>
<h5 id="simpleui">simpleui</h5>
<p><a href="https://gitee.com/tompeppa/simpleui#https://gitee.com/link?target=https%3A%2F%2Fwww.mldoo.com%2Fdemo%2Fsimplepro" target="_blank" rel="noopener">simpleui: django admin 的一个主题</a></p>
<p>只需要安装并且在settings文件的INSTALLED_APPS配置即可。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pip install django-simpleui
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="c1"># Application definition</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;simpleui&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span></code></pre></div><h3 id="restful-api服务">RESTFUL API服务</h3>
<p><a href="https://www.django-rest-framework.org" target="_blank" rel="noopener">https://www.django-rest-framework.org</a></p>
<p><a href="https://apifox.com/blog/a-cup-of-tea-time-to-understand-restful-api/?utm_source=google_dsa&amp;utm_medium=g&amp;utm_campaign=20543997484&amp;utm_content=152746906545&amp;utm_term=&amp;gad_source=1&amp;gclid=CjwKCAiA1MCrBhAoEiwAC2d64WeGeyUGbav_t8ao2QT5EVu-dLZHzv297H82yYuq2wxa1-2xrSstEhoCE7QQAvD_BwE" target="_blank" rel="noopener">一杯茶的时间，搞懂 RESTful API</a></p>
<p>Django中可以通过一些扩展库便利地实现RESTful风格的API，比如：</p>
<pre tabindex="0"><code>djangorestframework
</code></pre><p>只需要安装该库并且在配置文件中配置该APP，即可进行RESTful风格的API开发</p>
<pre tabindex="0"><code>pip install djangorestframework
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h4 id="参考文章">参考文章</h4>
<ul>
<li><a href="https://www.atatus.com/blog/rest-api-best-practices-for-parameter-and-query-string-usage/" target="_blank" rel="noopener">REST API Best Practices for Parameter and Query String Usage</a></li>
</ul>
<h3 id="django项目部署">Django项目部署</h3>
<h4 id="参考文章-1">参考文章</h4>
<ul>
<li>
<p><a href="https://docs.djangoproject.com/en/4.2/howto/deployment/wsgi/" target="_blank" rel="noopener">How to deploy with WSGI | Django documentation | Django</a></p>
</li>
<li>
<p><a href="https://docs.djangoproject.com/en/4.2/howto/deployment/wsgi/gunicorn/" target="_blank" rel="noopener">How to use Django with Gunicorn | Django documentation | Django</a></p>
</li>
</ul>
<h4 id="基于uwsgi服务器部署">基于uwsgi服务器部署</h4>
<p>安装uwsgi</p>
<pre tabindex="0"><code>conda install -c conda-forge uwsgi
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">uwsgi --http :8090 --chdir projectpath --module museum_geo_api.wsgi
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_command_hu0e86773b8981c6f040c85d5d83abe09d_169357_e383157d669fe7aee6722da1e754ba30.webp 400w,
               /post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_command_hu0e86773b8981c6f040c85d5d83abe09d_169357_2d6b345adda860317b22d1b3a84d84c5.webp 760w,
               /post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_command_hu0e86773b8981c6f040c85d5d83abe09d_169357_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_command_hu0e86773b8981c6f040c85d5d83abe09d_169357_e383157d669fe7aee6722da1e754ba30.webp"
               width="760"
               height="222"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_deploy_hudf5ae2864f84d3cc9ca5efba857438af_134764_03419a052a70729628cefcd5a7231e1c.webp 400w,
               /post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_deploy_hudf5ae2864f84d3cc9ca5efba857438af_134764_2336ca7d4e10667795ec5a524b743ee4.webp 760w,
               /post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_deploy_hudf5ae2864f84d3cc9ca5efba857438af_134764_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/deploy/uwsgi/uwsgi_deploy_hudf5ae2864f84d3cc9ca5efba857438af_134764_03419a052a70729628cefcd5a7231e1c.webp"
               width="760"
               height="455"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>也可以将wsgi服务的配置写在.ini文件中</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[uwsgi]</span>
</span></span><span class="line"><span class="cl"><span class="na">http</span><span class="o">=</span><span class="s">:8001</span>
</span></span><span class="line"><span class="cl"><span class="na">chdir</span><span class="o">=</span><span class="s">/Users/weirdgiser/文稿/Projects/Cultural/musuem_geo_api_dev/museum_geo_api/museum_geo_api</span>
</span></span><span class="line"><span class="cl"><span class="na">module</span><span class="o">=</span><span class="s">museum_geo_api.wsgi</span>
</span></span></code></pre></div><p>指定.ini文件启动服务</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> uwsgi --ini uwsgi.ini  --enable-threads 
</span></span></code></pre></div><h4 id="基于gunicorn部署">基于gunicorn部署</h4>
<ul>
<li><a href="https://gunicorn.org/" target="_blank" rel="noopener">https://gunicorn.org/</a></li>
</ul>
<p>新建配置文件</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># 指定服务器监听的IP和端口</span>
</span></span><span class="line"><span class="cl"><span class="n">bind</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0:8010&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 指定工作进程的数量</span>
</span></span><span class="line"><span class="cl"><span class="n">workers</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 指定工作进程使用的协程库</span>
</span></span><span class="line"><span class="cl"><span class="n">worker_class</span> <span class="o">=</span> <span class="s2">&#34;gevent&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ----应用程序的设置</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 指定为项目根目录</span>
</span></span><span class="line"><span class="cl"><span class="n">chdir</span> <span class="o">=</span> <span class="s2">&#34;/Users/weirdgiser/文稿/Projects/Cultural/musuem_geo_api_dev/museum_geo_api/museum_geo_api&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 指定WSGI应用程序的模块和应用</span>
</span></span><span class="line"><span class="cl"><span class="n">module</span> <span class="o">=</span> <span class="s2">&#34;museum_geo_api.wsgi:application&#34;</span>
</span></span></code></pre></div><p>启动服务</p>
<pre tabindex="0"><code>gunicorn -c gunicorn_config.py museum_geo_api.wsgi:application
</code></pre><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/deploy/gunicorn/run_gunicorn_hu37258c882fd5190ebc117abf6205ea15_119888_ac5ba3db36541836a048c51d2007d394.webp 400w,
               /post/django-core-techs-notes/images/deploy/gunicorn/run_gunicorn_hu37258c882fd5190ebc117abf6205ea15_119888_396dad9992373c3060bcc5edb1976d68.webp 760w,
               /post/django-core-techs-notes/images/deploy/gunicorn/run_gunicorn_hu37258c882fd5190ebc117abf6205ea15_119888_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/deploy/gunicorn/run_gunicorn_hu37258c882fd5190ebc117abf6205ea15_119888_ac5ba3db36541836a048c51d2007d394.webp"
               width="760"
               height="179"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/deploy/gunicorn/test_hue17ca677b8370ef105fee5ad19db4547_205426_ebd836d307280d5b413d2afe6506ed30.webp 400w,
               /post/django-core-techs-notes/images/deploy/gunicorn/test_hue17ca677b8370ef105fee5ad19db4547_205426_95b4253aaa79e4a2bee1bc299f658ad1.webp 760w,
               /post/django-core-techs-notes/images/deploy/gunicorn/test_hue17ca677b8370ef105fee5ad19db4547_205426_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/deploy/gunicorn/test_hue17ca677b8370ef105fee5ad19db4547_205426_ebd836d307280d5b413d2afe6506ed30.webp"
               width="760"
               height="498"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h3 id="django用户模型及拓展">Django用户模型及拓展</h3>
<p>django.contrib.auth.models模块中包含django自带的用户模型实现，如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AbstractUser</span><span class="p">(</span><span class="n">AbstractBaseUser</span><span class="p">,</span> <span class="n">PermissionsMixin</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    An abstract base class implementing a fully featured User model with
</span></span></span><span class="line"><span class="cl"><span class="s2">    admin-compliant permissions.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Username and password are required. Other fields are optional.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">username_validator</span> <span class="o">=</span> <span class="n">UnicodeUsernameValidator</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">username</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span><span class="p">(</span><span class="s2">&#34;username&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">username_validator</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">error_messages</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;unique&#34;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s2">&#34;A user with that username already exists.&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&#34;first name&#34;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&#34;last name&#34;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&#34;email address&#34;</span><span class="p">),</span> <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_staff</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span><span class="p">(</span><span class="s2">&#34;staff status&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s2">&#34;Designates whether the user can log into this admin site.&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_active</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span><span class="p">(</span><span class="s2">&#34;active&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Designates whether this user should be treated as active. &#34;</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Unselect this instead of deleting accounts.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">date_joined</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&#34;date joined&#34;</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">objects</span> <span class="o">=</span> <span class="n">UserManager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">EMAIL_FIELD</span> <span class="o">=</span> <span class="s2">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">USERNAME_FIELD</span> <span class="o">=</span> <span class="s2">&#34;username&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">REQUIRED_FIELDS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;email&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&#34;users&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">abstract</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">normalize_email</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Return the first_name plus the last_name, with a space in between.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">full_name</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">full_name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Return the short name for the user.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">email_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">from_email</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Send an email to this user.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">send_mail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">from_email</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">email</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Users within the Django authentication system are represented by this
</span></span></span><span class="line"><span class="cl"><span class="s2">    model.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    Username and password are required. Other fields are optional.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">AbstractUser</span><span class="o">.</span><span class="n">Meta</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">swappable</span> <span class="o">=</span> <span class="s2">&#34;AUTH_USER_MODEL&#34;</span>
</span></span></code></pre></div><p>假如我们想快速实现一个用户管理的功能，最快就是在django用户上进行拓展，使用django自带用户的用户、密码等基础属性，拓展新字段如L电话号码、地址、教育程度等属性。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ExtendedUser</span><span class="p">(</span><span class="n">AbstractUser</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">phone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">db_comment</span><span class="o">=</span><span class="s2">&#34;电话号码&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">residential_address</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">db_comment</span><span class="o">=</span><span class="s2">&#34;住宅地址&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">wechat_openid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">db_comment</span><span class="o">=</span><span class="s2">&#34;微信公开ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">education</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">db_comment</span><span class="o">=</span><span class="s2">&#34;教育程度&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">graduate_institution</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">db_comment</span><span class="o">=</span><span class="s2">&#34;毕业院校&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">vip_effective_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">db_comment</span><span class="o">=</span><span class="s2">&#34;VIP有效日期期限&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_permissions</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">Permission</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name</span><span class="o">=</span> <span class="s1">&#39;用户权限&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">help_text</span><span class="o">=</span> <span class="s1">&#39;Specific permissions for this user.&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 对当前表进行相关设置:</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">managed</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;extended_users&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;用户基础表&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">verbose_name</span>
</span></span></code></pre></div><p>定义好模型文件就可以迁移，将表结构物理同步到数据库中</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">python manage.py makemigrations app_name
</span></span><span class="line"><span class="cl">python manage.py migrate app_name
</span></span></code></pre></div><p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/user/customed_user_migrate_hu4f1ffe3972cd2fe6a09aed6d4c744408_137652_65cdd9f2df73727e8d3ecdbf1184447d.webp 400w,
               /post/django-core-techs-notes/images/user/customed_user_migrate_hu4f1ffe3972cd2fe6a09aed6d4c744408_137652_d9f9ca0e80bef2eb8e3143ca9ecbd638.webp 760w,
               /post/django-core-techs-notes/images/user/customed_user_migrate_hu4f1ffe3972cd2fe6a09aed6d4c744408_137652_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/user/customed_user_migrate_hu4f1ffe3972cd2fe6a09aed6d4c744408_137652_65cdd9f2df73727e8d3ecdbf1184447d.webp"
               width="760"
               height="232"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<p>【注】默认用户模型的字段不允许为空，需要显式设置null=True表明字段可以为空，另外，如果需要通过django admin管理用户模型，对于允许为空的字段还需要显式设置blank=True，否则后台管理页面的前端会校验字段值要求必填。</p>
<h3 id="django服务日志记录">Django服务日志记录</h3>
<ul>
<li>通过中间件记录接口请求记录</li>
</ul>
<h4 id="参考文档">参考文档</h4>
<p><a href="https://docs.djangoproject.com/zh-hans/4.2/topics/logging/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/4.2/topics/logging/</a></p>
<p>Django默认使用logging模块进行日志记录，可以在settings.py文件中配置LOGGING变量对日志进行配置。如：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 日志模块配置</span>
</span></span><span class="line"><span class="cl"><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;version&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;disable_existing_loggers&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;formatters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;verbose&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;format&#34;</span><span class="p">:</span> <span class="s2">&#34;</span><span class="si">{levelname}</span><span class="s2"> </span><span class="si">{asctime}</span><span class="s2"> </span><span class="si">{module}</span><span class="s2"> </span><span class="si">{process:d}</span><span class="s2"> </span><span class="si">{thread:d}</span><span class="s2"> </span><span class="si">{message}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;style&#34;</span><span class="p">:</span> <span class="s2">&#34;{&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;simple&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;format&#34;</span><span class="p">:</span> <span class="s2">&#34;</span><span class="si">{levelname}</span><span class="s2"> </span><span class="si">{asctime}</span><span class="s2"> </span><span class="si">{module}</span><span class="s2"> </span><span class="si">{message}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;style&#34;</span><span class="p">:</span> <span class="s2">&#34;{&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;handlers&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;console&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;class&#34;</span><span class="p">:</span> <span class="s2">&#34;logging.StreamHandler&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;formatter&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;file&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="p">:</span> <span class="s2">&#34;DEBUG&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;class&#34;</span><span class="p">:</span> <span class="s2">&#34;logging.FileHandler&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;filename&#34;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s2">&#34;logs&#34;</span><span class="p">,</span><span class="s2">&#34;museum_geo_api.log&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;formatter&#34;</span><span class="p">:</span> <span class="s2">&#34;verbose&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;loggers&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;django&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;handlers&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;console&#34;</span><span class="p">,</span><span class="s2">&#34;file&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;level&#34;</span><span class="p">:</span> <span class="s2">&#34;INFO&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;propagate&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>通过formatter可以配置日志格式器，handlers配置日志处理类（如流处理StreamHandler、文件处理FileHandler），loggers配置启用的日志记录器。关于这些模块的介绍可以参考博文<a href="https://coolgiserz.github.io/post/python-logging-usage-and-extend/" target="_blank" rel="noopener">Python内置日志模块源码分析和进阶用法 | CoolCats</a></p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/logging/filelog_hubf8e2fa52f78106210518ce657fc7628_150401_2960b01af033cfceba3eaecfdd73a91e.webp 400w,
               /post/django-core-techs-notes/images/logging/filelog_hubf8e2fa52f78106210518ce657fc7628_150401_b0753f6c01572915929f9359ec5f18e6.webp 760w,
               /post/django-core-techs-notes/images/logging/filelog_hubf8e2fa52f78106210518ce657fc7628_150401_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/logging/filelog_hubf8e2fa52f78106210518ce657fc7628_150401_2960b01af033cfceba3eaecfdd73a91e.webp"
               width="760"
               height="140"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<h3 id="heading-1"></h3>
<h3 id="django接口鉴权">Django接口鉴权</h3>
<ul>
<li>
<p>API Token</p>
<p>用户先通过认证接口，提供用户名、密码等认证信息进行认证，若认证通过后服务端向用户返回登录凭证（具有一定有效期）；后续的用户请求需要附带该登录凭证方可请求成功。</p>
</li>
<li>
<p>API Key + API Secret</p>
</li>
</ul>
<h2 id="0x02-django源码分析">0x02 Django源码分析</h2>
<h3 id="源码结构">源码结构</h3>
<p>以Django4.2.7为例，源码目录结构如下图所示：</p>
<p>















<figure  >
  <div class="d-flex justify-content-center">
    <div class="w-100" ><img alt="" srcset="
               /post/django-core-techs-notes/images/source_code/tree_hu5457b750e29afc9bb27e4cab783d91bb_77348_98fff4d4d7684632bdba6f3d73579582.webp 400w,
               /post/django-core-techs-notes/images/source_code/tree_hu5457b750e29afc9bb27e4cab783d91bb_77348_9d5197a59003ee4886f13ee7ce604db6.webp 760w,
               /post/django-core-techs-notes/images/source_code/tree_hu5457b750e29afc9bb27e4cab783d91bb_77348_1200x1200_fit_q75_h2_lanczos_3.webp 1200w"
               src="/post/django-core-techs-notes/images/source_code/tree_hu5457b750e29afc9bb27e4cab783d91bb_77348_98fff4d4d7684632bdba6f3d73579582.webp"
               width="695"
               height="760"
               loading="lazy" data-zoomable /></div>
  </div></figure>
</p>
<ul>
<li>
<p>apps</p>
</li>
<li>
<p>conf</p>
</li>
<li>
<p>contrib</p>
</li>
<li>
<p>core</p>
</li>
</ul>
<h2 id="0x03-django开源项目">0x03 Django开源项目</h2>
<h3 id="django-tenants">django-tenants</h3>
<h3 id="djangorestframework">djangorestframework</h3>
<p>Restful API</p>
<h3 id="geodjango">GeoDjango</h3>
<ul>
<li>
<p>获取多边形的中心点：<a href="https://stackoverflow.com/questions/40083521/django-get-centroid-of-polygon-in-geojson-format" target="_blank" rel="noopener">python - Django - Get centroid of polygon in geoJSON format - Stack Overflow</a></p>
</li>
<li>
<p>空间数据模型相关API：https://docs.djangoproject.com/en/4.2/ref/contrib/gis/db-api/</p>
</li>
<li>
<p>空间数据u相关函数：<a href="https://docs.djangoproject.com/en/1.11/ref/contrib/gis/functions/#django.contrib.gis.db.models.functions.Centroid" target="_blank" rel="noopener">Geographic Database Functions | Django documentation | Django</a></p>
</li>
<li>
<p>&hellip;&hellip;</p>
</li>
</ul>
<h3 id="django-rest-framework-jwt">django-rest-framework-jwt</h3>
<p>接口鉴权。</p>
<p><a href="https://www.cnblogs.com/superhin/p/16288059.html" target="_blank" rel="noopener">Python3 JWT的生成与验证 - 韩志超 - 博客园</a></p>
<h3 id="0x04-工具">0x04 工具</h3>
<p><a href="http://www.atoolbox.net/Tool.php?Id=921" target="_blank" rel="noopener">随机密码和密钥生成器 - 一个工具箱 - 好用的在线工具都在这里！</a></p>

    </div>

    




<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/django/">Django</a>
  
  <a class="badge badge-light" href="/tag/%E5%AF%B9%E8%B1%A1%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84/">对象关系映射</a>
  
  <a class="badge badge-light" href="/tag/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%BC%80%E5%8F%91/">服务端开发</a>
  
</div>



<div class="share-box">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/django-core-techs-notes/&amp;text=Django%e5%90%8e%e7%ab%af%e5%bc%80%e5%8f%91%e7%ac%94%e8%ae%b0" target="_blank" rel="noopener" class="share-btn-twitter" aria-label="twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/django-core-techs-notes/&amp;t=Django%e5%90%8e%e7%ab%af%e5%bc%80%e5%8f%91%e7%ac%94%e8%ae%b0" target="_blank" rel="noopener" class="share-btn-facebook" aria-label="facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Django%e5%90%8e%e7%ab%af%e5%bc%80%e5%8f%91%e7%ac%94%e8%ae%b0&amp;body=/post/django-core-techs-notes/" target="_blank" rel="noopener" class="share-btn-email" aria-label="envelope">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/django-core-techs-notes/&amp;title=Django%e5%90%8e%e7%ab%af%e5%bc%80%e5%8f%91%e7%ac%94%e8%ae%b0" target="_blank" rel="noopener" class="share-btn-linkedin" aria-label="linkedin-in">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Django%e5%90%8e%e7%ab%af%e5%bc%80%e5%8f%91%e7%ac%94%e8%ae%b0%20/post/django-core-techs-notes/" target="_blank" rel="noopener" class="share-btn-whatsapp" aria-label="whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/django-core-techs-notes/&amp;title=Django%e5%90%8e%e7%ab%af%e5%bc%80%e5%8f%91%e7%ac%94%e8%ae%b0" target="_blank" rel="noopener" class="share-btn-weibo" aria-label="weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="/authors/admin/"><img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu55194f19033f85038196a23353ffe543_580100_270x270_fill_q75_lanczos_center.jpg" alt="CoolCats"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/admin/">CoolCats</a></h5>
      <h6 class="card-subtitle">理学学士</h6>
      <p class="card-text">我的研究兴趣是时空数据分析、知识图谱、自然语言处理与服务端开发</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:2811159909@qq.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/Coolgiserz" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>









  
  
  

  

  










  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  

  

  
  






  
  
  

  
  
    
  
  
    
  

  

  
  <p class="powered-by copyright-license-text">
    © 2024 CoolCats. This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank">CC BY NC ND 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by-nc-nd/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
        <i class="fab fa-creative-commons-nc fa-2x" aria-hidden="true"></i>
      
      
        <i class="fab fa-creative-commons-nd fa-2x" aria-hidden="true"></i>
      
    </a>
  </p>




  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

      

    
    <script src="/js/vendor-bundle.min.fab8b449b814cc9f95b22fcf2e45f05b.js"></script>

    
    
    
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/latex.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    
      <script id="dsq-count-scr" src="https://coolgiserz.disqus.com/count.js" async></script>
    

    
    
      
      
      
      
      
      
      
    

    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":true}</script>

    
    
      <script src="/js/wowchemy-headroom.c251366b4128fd5e6b046d4c97a62a51.js" type="module"></script>
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.ab2f2890dbe3e2e83579366d3d6e8fd9.js"></script>

    
    
      <script src="/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js" type="module"></script>
    
    
    
    
      
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      <script src="/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>






</body>
</html>
