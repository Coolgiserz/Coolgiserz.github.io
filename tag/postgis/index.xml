<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>PostGIS | CoolCats</title>
    <link>/tag/postgis/</link>
      <atom:link href="/tag/postgis/index.xml" rel="self" type="application/rss+xml" />
    <description>PostGIS</description>
    <generator>Wowchemy (https://wowchemy.com)</generator><language>en-us</language><lastBuildDate>Mon, 22 Jan 2024 16:40:26 +0800</lastBuildDate>
    <image>
      <url>/media/icon_hue03491371183284312b8b116a73ae5ab_79511_512x512_fill_lanczos_center_3.png</url>
      <title>PostGIS</title>
      <link>/tag/postgis/</link>
    </image>
    
    <item>
      <title>PostgreSQL使用过程中遇到的一些问题分析和注意事项笔记</title>
      <link>/post/postgres-usage-issues-notes/</link>
      <pubDate>Mon, 22 Jan 2024 16:40:26 +0800</pubDate>
      <guid>/post/postgres-usage-issues-notes/</guid>
      <description>&lt;h2 id=&#34;关于数据类型&#34;&gt;关于数据类型&lt;/h2&gt;
&lt;h3 id=&#34;smallserialserial和bigserial&#34;&gt;smallserial、serial和bigserial&lt;/h3&gt;
&lt;p&gt;pgsql中如果需要实现自增长ID字段，可以采用serial类型&lt;/p&gt;
&lt;h3 id=&#34;时间日期相关字段&#34;&gt;时间、日期相关字段&lt;/h3&gt;
&lt;p&gt;根据&lt;a href=&#34;http://www.postgres.cn/docs/13/datatype-datetime.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL中文社区的文档&lt;/a&gt;，PostgreSQL支持的日期和时间类型包括如下：&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /post/postgres-usage-issues-notes/images/fields/time_and_datetime_hu882542cfecad0f42b4dfb6559d5ecbac_191277_af4de01f35f80f34a71824c2e0312d28.webp 400w,
               /post/postgres-usage-issues-notes/images/fields/time_and_datetime_hu882542cfecad0f42b4dfb6559d5ecbac_191277_5a4813a239dd479b56602abf53249cac.webp 760w,
               /post/postgres-usage-issues-notes/images/fields/time_and_datetime_hu882542cfecad0f42b4dfb6559d5ecbac_191277_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;/post/postgres-usage-issues-notes/images/fields/time_and_datetime_hu882542cfecad0f42b4dfb6559d5ecbac_191277_af4de01f35f80f34a71824c2e0312d28.webp&#34;
               width=&#34;760&#34;
               height=&#34;187&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;对于日期而言，支持的可能输入包括下图所示输入：&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /post/postgres-usage-issues-notes/images/fields/possible_date_input_hu9465996e6b65543a7c9b19d3ef9bd627_259312_b867329241d3ca9e6fd27df7dad6fb26.webp 400w,
               /post/postgres-usage-issues-notes/images/fields/possible_date_input_hu9465996e6b65543a7c9b19d3ef9bd627_259312_c7ac07f4b4b73a2e69dc2d5462f9805b.webp 760w,
               /post/postgres-usage-issues-notes/images/fields/possible_date_input_hu9465996e6b65543a7c9b19d3ef9bd627_259312_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;/post/postgres-usage-issues-notes/images/fields/possible_date_input_hu9465996e6b65543a7c9b19d3ef9bd627_259312_b867329241d3ca9e6fd27df7dad6fb26.webp&#34;
               width=&#34;760&#34;
               height=&#34;631&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;对于时间而言，支持的可能输入包括下图所示：&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /post/postgres-usage-issues-notes/images/fields/possible_time_input_hu4474549625705d540ddadc4eae859992_219853_887f8ff235c21975544aa8a910d7fdbd.webp 400w,
               /post/postgres-usage-issues-notes/images/fields/possible_time_input_hu4474549625705d540ddadc4eae859992_219853_f54746ce87996ff255ddfd4e558e8cb4.webp 760w,
               /post/postgres-usage-issues-notes/images/fields/possible_time_input_hu4474549625705d540ddadc4eae859992_219853_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;/post/postgres-usage-issues-notes/images/fields/possible_time_input_hu4474549625705d540ddadc4eae859992_219853_887f8ff235c21975544aa8a910d7fdbd.webp&#34;
               width=&#34;760&#34;
               height=&#34;525&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;p&gt;可以看到，PostgreSQL的日期和时间类型对于是否有时区做了精细的分类；对于带时区(with timezone)的类型，查询时数据库会自动将数据转为客户端时区再显示；对于不带时区（without timezone）的类型，数据库对数据的存储和展现完全不受客户端时区影响。可以通过&lt;code&gt;show timezone&lt;/code&gt;命令查看数据库会话时区。&lt;/p&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /post/postgres-usage-issues-notes/images/fields/session_timezone_show_huba0bdd758c7b7deb14a2a3eb941f58fd_77972_4d2be3c8b1cad4c1169092fbe514e052.webp 400w,
               /post/postgres-usage-issues-notes/images/fields/session_timezone_show_huba0bdd758c7b7deb14a2a3eb941f58fd_77972_d6b71a4399a3bd142165201a60c93d51.webp 760w,
               /post/postgres-usage-issues-notes/images/fields/session_timezone_show_huba0bdd758c7b7deb14a2a3eb941f58fd_77972_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;/post/postgres-usage-issues-notes/images/fields/session_timezone_show_huba0bdd758c7b7deb14a2a3eb941f58fd_77972_4d2be3c8b1cad4c1169092fbe514e052.webp&#34;
               width=&#34;760&#34;
               height=&#34;682&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h4 id=&#34;实践中遇到的一些细节问题&#34;&gt;实践中遇到的一些细节问题&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;更新日期/时间型字段的报错&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果要变更的新类型与旧类型之间不可进行强制类型转换，则需要删除字段再重建，如：&lt;/p&gt;
&lt;p&gt;approval_date原本是time类型字段，其不可自动强制转换date类型，于是通过sql修改字段类型需要删除并重建字段。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DROP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COLUMN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;approval_date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COLUMN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;approval_date&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gb_industry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;DROP&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COLUMN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;updated_at&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALTER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TABLE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gb_industry&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ADD&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;COLUMN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;updated_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;timestamptz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;text类型&#34;&gt;Text类型&lt;/h3&gt;
&lt;p&gt;text类型字段是否浪费空间，对于不确定长度的字段应该用character varing并指定一个很大的最大长度好还是直接使用text类型好？&lt;/p&gt;
&lt;p&gt;先说背景，在进行一些数据入库操作时，经常发现预定义的vary charecter不足以存储完整数据，多次手动扩容还是遇到数据超长问题，直接使用text可以避免数据超长/截断问题，但是这会造成空间浪费吗？text类型字段在pgsql内部机制是动态扩容还是默认超大固定空间？&lt;/p&gt;
&lt;p&gt;根据一篇pgsql教程网站的博客:&lt;a href=&#34;https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-char-varchar-text/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PostgreSQL Character Types: CHAR, VARCHAR, And TEXT&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;TEXT和不指定最大长度的CHARECTER VARYING类型是一样的，文章建议：一般来说除非需要检查（或希望数据库明确指出）数据是否超出一定长度，都应该使用TEXT。&lt;/p&gt;
&lt;p&gt;对于text是否会浪费更多空间，查到了相关问题，但尚未发现提供了足够的技术细节论证的答案&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/23988406/string-field-length-in-postgres-sql&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;postgresql - String field length in Postgres SQL - Stack Overflow&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://stackoverflow.com/questions/20326892/any-downsides-of-using-data-type-text-for-storing-strings&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://stackoverflow.com/questions/20326892/any-downsides-of-using-data-type-text-for-storing-strings&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;空间模型字段&#34;&gt;空间模型字段&lt;/h3&gt;
&lt;p&gt;HINT: No function matches the given name and argument types. You might need to add explicit type casts.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mailing_address_point&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ST_AsEWKB&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;registered_address_point&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company_registered_address_point&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mailing_address_point&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mailing_address&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;IS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NOT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;orm操作空间模型字段的问题&#34;&gt;ORM操作空间模型字段的问题&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;应该使用geometry类型还是更精确的point、linestring、polygon类型？&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如何从point类型改为geometry类型？&lt;/p&gt;
&lt;p&gt;point类型无法通过强制类型转换为geometry类型，简单的办法是删除字段再重建。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;如何查询几何对象并以WKT格式输出？&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;st_astext&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;geo&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;poi_address_coordinate_log&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /post/postgres-usage-issues-notes/images/fields/st_astext_huaaa6910ee499902fd02800e42ab2e8fa_136811_045bf392c5cdcf5d69b0cb3918895b1e.webp 400w,
               /post/postgres-usage-issues-notes/images/fields/st_astext_huaaa6910ee499902fd02800e42ab2e8fa_136811_60f3275f0e565bda256c9682bc35195e.webp 760w,
               /post/postgres-usage-issues-notes/images/fields/st_astext_huaaa6910ee499902fd02800e42ab2e8fa_136811_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;/post/postgres-usage-issues-notes/images/fields/st_astext_huaaa6910ee499902fd02800e42ab2e8fa_136811_045bf392c5cdcf5d69b0cb3918895b1e.webp&#34;
               width=&#34;679&#34;
               height=&#34;760&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;基于sqlalchemy ORM框架如何写geometry对象？&lt;/p&gt;
&lt;p&gt;基于geoalchemy2库的函数可以构建空间要素类型，兼容sqlalchemy。以点要素为例，通过ST_MakePoint方法构建的点要素类型可直接赋给postgresql中数据表的空间要素字段.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;ST_MakePoint(114,22)
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://geoalchemy-2.readthedocs.io/en/latest/core_tutorial.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Core Tutorial — GeoAlchemy2 0.14.4.dev1+g4e4f45d documentation&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;hellip;&amp;hellip;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;关于触发器&#34;&gt;关于触发器&lt;/h2&gt;
&lt;p&gt;为了记录数据变更时间，往往会有一个字段在数据发生更新时自动记录当前时间戳，对于MySQL而言可以很方便地通过设置下列额外值实现这个需求，但对于PgSQL而言却是另一种做法。&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;on update CURRENT_TIMESTAMP
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;PgSQL中需要使用触发器实现这个功能：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;创建触发器函数&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FUNCTION&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;update_updated_on_company&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURNS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TRIGGER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEGIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NEW&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;updated_at&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;now&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;RETURN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;NEW&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;$$&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;language&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;plpgsql&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;创建触发器&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;CREATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;TRIGGER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;update_company_updated_on&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BEFORE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;company&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FOR&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EACH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ROW&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;EXECUTE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PROCEDURE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;update_updated_on_company_task&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img alt=&#34;&#34; srcset=&#34;
               /post/postgres-usage-issues-notes/images/fields/updated_at_hu1d6bbcc980d3f5f988b9feb8ae9e488c_156706_77fda5502740486c30d46d1299a6ad30.webp 400w,
               /post/postgres-usage-issues-notes/images/fields/updated_at_hu1d6bbcc980d3f5f988b9feb8ae9e488c_156706_c05349d7f9312743d62fb227070f67dc.webp 760w,
               /post/postgres-usage-issues-notes/images/fields/updated_at_hu1d6bbcc980d3f5f988b9feb8ae9e488c_156706_1200x1200_fit_q75_h2_lanczos_3.webp 1200w&#34;
               src=&#34;/post/postgres-usage-issues-notes/images/fields/updated_at_hu1d6bbcc980d3f5f988b9feb8ae9e488c_156706_77fda5502740486c30d46d1299a6ad30.webp&#34;
               width=&#34;760&#34;
               height=&#34;194&#34;
               loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;h2 id=&#34;关于数据迁移&#34;&gt;关于数据迁移&lt;/h2&gt;
</description>
    </item>
    
    <item>
      <title>全国博物馆馆藏文物空间数据库</title>
      <link>/project/cultural-heritage-spatial-database/</link>
      <pubDate>Mon, 08 Jul 2019 21:23:19 +0800</pubDate>
      <guid>/project/cultural-heritage-spatial-database/</guid>
      <description>&lt;h3 id=&#34;背景&#34;&gt;背景&lt;/h3&gt;
&lt;p&gt;文物博物馆管理工作的基本操作流程主要包括:藏品来源、移交入馆、馆内清理、入库、库内整理等诸多环节。在这个过程中，由于博物馆中藏品数量巨大，藏品的规格、大小也各不相同，在这种情况下，如果只依靠人工的管理 方式，将难以全面准确地对藏品进行管理，任何疏漏都可能导致严重的后果， 造成文物和藏品的损失。&lt;/p&gt;
&lt;p&gt;所以，现在我国大部分博物馆都建立起了数据库，但是大部分博物馆都有适合自己地域或地方特色的藏品管理方式。而要在这个管理规定的基础上再建 立产品的数字化管理系统，就难以保证我国博物馆管理行业内的管理方式统一 化。差异化的数据库标准和不同管理模式的侧重性，都为不同博物馆间数据共 享和管理平台的统一带来了困难。每一个管理系统的个体，都有极强的针对性 和差异性，只适用于单一博物馆，系统平台的通用性较差。并且，由于经费、 政治等因素，大部分的博物馆数据库都比较缺乏维护，如果拥有一个统一标准 的、规范的博物馆数据库，并应用于全国的博物馆的管理当中，充分发挥数字 化管理的效能，全面促进博物馆信息化资源共享的实现，实现更好的服务。&lt;/p&gt;
&lt;p&gt;目前，我国的博物馆与空间数据相关联系还比较少，然而博物馆与空间数据息息相关，例如:1文物出入库的流动信息与空间数据相关，如果没有一个比较规范的记录，容易造成文物的流失;2我国博物馆常常是一个地区文化、 历史的见证，具有较高的参观、旅游价值，所以将博物馆与地理信息相联系， 方便用户更快查询博物馆，可为更多参观者、研究人员提供服务。&lt;/p&gt;
&lt;h3 id=&#34;系统目的和任务&#34;&gt;系统目的和任务&lt;/h3&gt;
&lt;p&gt;该系统的目的是建立全国博物馆的空间数据库，旨在为公众提供全国各地 博物馆的信息查询与空间分析功能以及为博物馆研究人员提供较为完善的数据 分析查询平台支持。系统主要任务如下:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;收集整理全国博物馆基本信息及其地理空间信息&lt;/li&gt;
&lt;li&gt;收集整理博物馆馆藏文物信息&lt;/li&gt;
&lt;li&gt;收集整理全国基础地理数据（行政区划及道路、水系要素等）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;系统支持如下功能：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;博物馆信息查询功能
如查询某地的博物馆分布情况、查询博物馆信息、查询各类型博物馆藏品的空间分布情况等&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;博物馆空间分析功能
如区域博物馆分布密度分析、查询某一位置点一定缓冲区内的博物馆情况、博物馆旅游规划功能等&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;技术细节整理&#34;&gt;技术细节（整理&amp;hellip;）&lt;/h3&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./images/fig4-6.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;总体入库框架&lt;/center&gt;
&lt;h3 id=&#34;建设成果应用&#34;&gt;建设成果（应用）&lt;/h3&gt;
&lt;h4 id=&#34;博物馆数据空间查询&#34;&gt;博物馆数据空间查询&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./images/fig5-5.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;博物馆空间查询&lt;/center&gt;
&lt;h4 id=&#34;博物馆空间分析&#34;&gt;博物馆空间分析&lt;/h4&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./images/fig5-6.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;博物馆空间分布密度估计&lt;/center&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./images/fig5-14.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;全国瓷器藏品空间分布&lt;/center&gt;
&lt;p&gt;&amp;hellip;&lt;/p&gt;
&lt;h4 id=&#34;地域文物文本挖掘&#34;&gt;地域文物文本挖掘&lt;/h4&gt;
&lt;p&gt;按地级市聚合统计其包含的文物，对文物名称进行中文分词和词频统计，生成各个地级市的文
物词频图，示例如：
















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./images/fig5-21.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;洛阳市文物词频图&lt;/center&gt;
&lt;p&gt;















&lt;figure  &gt;
  &lt;div class=&#34;d-flex justify-content-center&#34;&gt;
    &lt;div class=&#34;w-100&#34; &gt;&lt;img src=&#34;./images/fig5-22.png&#34; alt=&#34;&#34; loading=&#34;lazy&#34; data-zoomable /&gt;&lt;/div&gt;
  &lt;/div&gt;&lt;/figure&gt;
&lt;/p&gt;
&lt;center&gt;绍兴市文物词频图&lt;/center&gt;
&lt;h4 id=&#34;其它&#34;&gt;其它&lt;/h4&gt;
&lt;p&gt;暂略&lt;/p&gt;
&lt;h2 id=&#34;参考资料&#34;&gt;参考资料&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://baike.baidu.com/museum&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;百度博物馆地图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://gl.sach.gov.cn/sachhome/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;国家文物局综合行政管理平台&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://gl.sach.gov.cn/collection-of-cultural-relics/index.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;全国文物馆藏名录&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.chnmuseum.cn/gbgk/gbjj/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;中国国家博物馆简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;文物博物馆管理中的问题及措施研究 肖仁杰&lt;/li&gt;
&lt;li&gt;博物馆藏品的数字化管理 付森&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
  </channel>
</rss>
